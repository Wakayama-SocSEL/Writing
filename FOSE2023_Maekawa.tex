% 英文で執筆する場合はクラスファイルへのオプションを[T,E]としてください．
% If you want to write your paper in English, pass to [T,E] options to document class.
\documentclass[T,J]{fose} % 「コンピュータソフトウェア」用のクラスファイルは compsoft です．
\taikai{2023} % 固定です．出版委員長が毎年変更してAuthor Kitを配布してください．

\usepackage [dvipdfmx] {graphicx}
\usepackage{multirow}

% ユーザが定義したマクロなどはここに置く．ただし学会誌のスタイルの
% 再定義は原則として避けること．

% 以下は説明のために使用したパッケージであるため，削除可能．
\usepackage{fancyvrb}
\usepackage{xurl}
\usepackage{cite}
\usepackage{color}
\usepackage{listings}

\renewcommand{\lstlistingname}{Program}
\newcommand{\todo}[1]{\colorbox{yellow}{{\bf TODO}:}{\color{red} {\textbf{[#1]}}}}

\begin{document}

% 論文のタイトル
\title{JavaScriptテストコード変更内容に基づく\\後方互換性の判定精度の検証}
% 以下の \etitle（と\@etitle）はFOSE論文フォーマット独自のマクロです．
% FOSEに投稿した論文を発展させてコンピュータソフトウェアに投稿される場合はコメントアウトしてください．
% \setetitleは奇数ページのヘッダに表示する文字列（\etitle）を設定するためのマクロです．
% タイトルが2行に渡る場合は "\\" を 使用することで任意の位置で改行をすることができます．
\setetitle{Testing the accuracy of backward compatibility determination through JavaScript test code changes}
%\setetitle{Long Long Long Long Long Long \\ Long Long Long Long Long \\ Long Long Long Long Long Long Long Long Long Long Long Long Paper Title}

% タイトル，著者などが複数行にわたり，論文冒頭の著者名が日本語アブストと重複して描画された場合に以下のコメントアウトを外してください．
%\longtitle

% 著者
% 和文論文の場合，姓と名の間には半角スペースを入れ，
% 複数の著者の間は全角スペースで区切る
%
\author{前川　大樹　伊原　彰紀　大森　楓己
%
% ここにタイトル英訳 (英文の場合は和訳) を書く．
% 英語タイトルは論文1ページ目左下，著者らの名前・所属一覧の一番上に表示される
%
% 上記\setetitle中で改行した場合は "\etitle" を削除し，改行(\\)を入れていないタイトルを記載してください．
% \ejtitleは1ページ目左下に挿入されるタイトルとして使用されます．
% また，"\etitle"はFOSE論文フォーマット独自のマクロです．
\ejtitle{\etitle}
%
% ここに著者英文表記 および
% 所属 (和文および英文) を書く．
% 複数著者の所属はまとめてよい．
%
%\shozoku{Daiki Maekawa}{和歌山大学}
%{Wakayama University}
% 複数著者の所属は以下のようにまとめてよい．
\shozoku{Daiki Maekawa, Akinori Ihara}{和歌山大学}
{Wakayama University}
}

%
% 和文アブストラクト
% In English paper, content of Jabstract will be ignored. 
\Jabstract{
ライブラリ更新には後方互換性の損失を伴うことがあるが，ライブラリの利用者が後方互換性を正確に判断することは困難である．従来研究では，ライブラリの動作を検証するテストコードの変更有無に着目した後方互換性の判定手法が提案されている．しかし，テストコードの変更内容は考慮されておらず誤検出も多い．本研究では，テストコードの変更内容を考慮した後方互換性の判定手法を提案し，その精度を検証した．その結果，\todo{結果}
}
%
% 英文アブストラクト（本サンプルの原論文にはなし）
% \Eabstract{
% \todo{英語アブストラクト}
% }
%
\maketitle \thispagestyle {empty}

% \begin{table*}[t]
% \label{table_test_pattern}
% \caption{テストコード変更内容と実際の後方互換性の有無}
% \begin{tabular}{|c|l|r|r|}
% \hline
% 従来研究の分類 & \multicolumn{1}{c|}{本研究の分類} & \multicolumn{1}{l|}{実際に後方互換性あり} & \multicolumn{1}{l|}{実際に後方互換性なし} \\ \hline
% \multirow{2}{*}{\begin{tabular}[c]{@{}c@{}}テスト追加\\ （後方互換性ありと判定）\end{tabular}} & テストスイートの追加 & 20（69\%） & 9（31\%） \\ \cline{2-4} 
%  & テストケースの追加 & 84（79\%） & 23（21\%） \\ \hline
% \multirow{2}{*}{\begin{tabular}[c]{@{}c@{}}テスト削除\\ （後方互換性なしと判定）\end{tabular}} & テストスイートの削除 & 4（40\%） & 6（60\%） \\ \cline{2-4} 
%  & テストケースの削除 & 8（42\%） & 11（58\%） \\ \hline
% \multirow{6}{*}{\begin{tabular}[c]{@{}c@{}}テスト変更\\ （後方互換性なしと判定）\end{tabular}} & アサーションの追加 & 35（83\%） & 7（17\%） \\ \cline{2-4} 
%  & アサーションの削除 & 8（100\%） & 0（0\%） \\ \cline{2-4} 
%  & 入力値の変更 & 7（100\%） & 0（0\%） \\ \cline{2-4} 
%  & 期待値の変更 & 23（72\%） & 9（28\%） \\ \cline{2-4} 
%  & 前提条件の変更 & 9（100\%） & 0（0\%） \\ \cline{2-4} 
%  & リファクタリング & 129（83\%） & 27（17\%） \\ \hline
% \end{tabular}
% \end{table*}

\section{はじめに}
サードパーティ製ライブラリ（以降，ライブラリ）は頻繁に更新されており，利用者は適宜ライブラリのバージョン更新が必要である．利用者が安全にライブラリを更新するために，ライブラリ開発者はバージョン名によって後方互換性を管理している．しかし，後方互換性の損失が見落とされることも多い．

% 利用者が安全にライブラリを更新するために，パッケージマネージャはバージョン名によって後方互換性を管理しているが，誤ったバージョン名により，後方互換性の損失が見落とされてしまうことも多い．

% この問題は，実行時までコードの不整合が検出されないJavaScriptのような動的な言語において顕著であるため，JavaScriptライブラリの
% 後方互換性を判定する研究が行われている．

この問題は，特にJavaScriptのような動的な言語において顕著であり，ライブラリと利用者のコードの不整合が実行時まで検出されないという課題がある．この課題に対して，JavaScriptライブラリの後方互換性を判定する研究が行われている．

松田らは，後方互換性を損失するライブラリの更新は，プログラムの更新と合わせてテストコードも修正すると考え，テストコードの変更有無による後方互換性の判定手法を提案した．
\cite{matsuda}
しかし，テストコードの変更内容を考慮しておらず，誤検出も多い．
% しかし，テストコードの変更内容を考慮しておらず，テストの誤り修正や実行手順の修正など，ライブラリ変更とは無関係のテストコード変更についても後方互換性を損失したと誤検出する．

本研究では，テストコードの変更内容に着目し，後方互換性の損失に関係するテスト変更内容を明らかにし，テスト変更内容に基づく後方互換性の判定手法の精度を評価する．


\section{RQ1：後方互換性の損失に関係するテストコード変更とは何か？}\label{rq1}

\subsection{調査方法}
% データセットとして，松田らのデータセット\cite{matsuda}を使用する．松田らは，人気の238件のJavaScriptライブラリについて，合計2,111件のライブラリバージョンを分析し，各バージョンの実際の後方互換性と，ライブラリのテスト変更有無をまとめている．

本分析では，松田らのデータセットに含まれるライブラリバージョン2,111件から，ライブラリテストに変更がある1,027件を抽出し，95％の信頼区間でサンプリングした280件を目視で確認した．


\subsection{調査結果と考察}

% ========================
\begin{table}[]
\caption{テストコード変更内容と実際の後方互換性}
\scalebox{0.95}[0.95]{
\begin{tabular}{|l|r|r|}
\hline
\multicolumn{1}{|c|}{\begin{tabular}[c]{@{}c@{}}テスト変更内容\end{tabular}} & \multicolumn{1}{c|}{\begin{tabular}[c]{@{}c@{}}後方互換性有\end{tabular}} & \multicolumn{1}{c|}{\begin{tabular}[c]{@{}c@{}}後方互換性無\end{tabular}} \\ \hline
テスト追加 & 104（76\%） & 32（24\%） \\ \hline
テスト削除 & 12（41\%） & 17（59\%） \\ \hline
期待値の変更 & 23（72\%） & 9（28\%） \\ \hline
リファクタリング & 129（83\%） & 27（17\%） \\ \hline
\end{tabular}
}
\label{table_test_pattern}
\end{table}
% ========================

表\ref{table_test_pattern}は，テストコード変更内容と，実際の後方互換性を示す．本論文では，紙面の都合上，特徴的な変更内容のみを示す．

テスト削除については，実際に後方互換性を損失した割合の方が高く，後方互換性の損失に関係するテスト変更であると示唆される．また，リファクタリングは件数も多くほとんどが実際には後方互換性を保っているため，従来研究の誤検出の原因であると分かる．

実際に後方互換性を損失したバージョンについて本体の変更内容とテスト変更内容を調査したところ，下記のような関係が分かった．

\begin{itemize}
    \item テスト追加は機能追加と機能拡張に伴い，機能拡張に伴う場合後方互換性の損失に関係する
    \item テスト削除は機能削除に伴い，後方互換性の損失に関係する
    \item 期待値の変更は，仕様変更やテストの修正に伴い，仕様変更に伴う場合後方互換性の損失に関係する
\end{itemize}

\section{RQ2：テストコード変更内容に基づく後方互換性の判定手法の有効性はどの程度か？}
本章では，\ref{rq1}章で述べた変更をそれぞれパターン化し，後方互換性の判定精度を検証する．

\vspace{-10pt}
\subsection{パターンの作成}\label{create_pattern}
テストコードの内容を抽象構文木で定義し，変更の種類はコード差分解析ツールであるGumTree\cite{gumtree}を用いて判定する．

% \subsubsection{テストコード内容の定義}
% JavaScriptの単体テストフレームワークとして使用される，JestやMochaの慣習に倣い，テストコード内容の定義を行う．

% \noindent\textbf{テストコードの定義：}関数呼び出しで，関数名がdescribeまたはitまたはtestであり，第一引数が文字列，第二引数が関数呼び出しのものを，テストコードとする.

% \noindent\textbf{アサーションの定義：}アサーションの記述形式はフレームワークにより異なるが，本分析では以下のように定義を行った．

% \subsubsection{テスト変更パターンの作成}\label{test_change_pattern}
\noindent\textbf{機能拡張によるテスト追加：}GumTreeでinsert-treeとして判定されたノードツリーがテストコードであればテスト追加とする．その上で，追加されたテストコードが，変更前に定義されたテストスイート内であれば機能拡張によるテスト追加と判定する．

\noindent\textbf{テスト削除：}GumTreeでdelete-treeとして判定されたノードツリーがテストコードであれば，テスト削除と判定する

\noindent\textbf{期待値の変更：}GumTreeでupdate-nodeとして判定されたノードが，期待値であり，入力値のノードがupdate-nodeとして検出されていなければ，仕様変更による期待値の変更と判定する．

本分析では，松田らのデータセットに含まれる2,111件のライブラリバージョンに対して，定義したパターンを検出した．

% \begin{enumerate}
%     \item ファイルパスにtestまたはspecを含み，かつファイル名の末尾が.js または.ts であるものをテストファイルとして収集する．ただし，ファイル末尾が.d.tsのものは型定義ファイルとして収集しない
%     \item 変更されたテストファイルについて，変更前後のコードをGumTreeに入力する．この時，入力のサイズに対して外れ値検定を行い，165,957バイト以上のもの56件は対象外とした
%     \item 作成したパターンに一致する変更が１つでも検出された場合，そのバージョンは後方互換性を損失したと判定する
% \end{enumerate}

% 詳細
% \noindent\textbf{手順１：テストファイルの収集 - }ファイルパスにtestまたはspecを含み，かつファイル名の末尾が.js または.ts であるものをテストファイルとして収集する．ただし，ファイル末尾が.d.tsのものは型定義ファイルとして収集しない
% \noindent\textbf{手順2：GumTreeへの入力の作成 - }各バージョンで変更されたテストファイル群に対して，GumTreeへの入力を作成する．GumTreeでは，変更前後のソースコードを入力する必要がある．ただし，テストファイル単位で入力を作成すると，ファイル名の変更やディレクトリ構造の変更などのリファクタリングに対して誤検出の原因となる．そのため，変更されたファイルをすべてひとつにまとめバージョン単位で入力を作成する．この時，変数名の重複による構文エラーを防ぐために，ファイルごとにコードブロックで囲み，改行で繋げる．import宣言またはexport宣言が含まれる場合，これらはファイルのトップレベルで宣言する必要があるため，コードブロックの外に出し，モジュールのオブジェクト名の末尾にエスケープ処理をしたファイル名を付与することで重複を防ぐ．
% \noindent\textbf{手順3：後方互換性の判定 - }作成したパターンに一致する変更が１つでも検出された場合，そのバージョンは後方互換性を損失したと判定する．

\subsection{結果と考察}

% ======================
\begin{table}[]
\centering
\caption{実際の後方互換性と，変更パターンの検出有無}
\begin{tabular}{|l|r|r|}
\hline
\multicolumn{1}{|c|}{} & \multicolumn{1}{c|}{\begin{tabular}[c]{@{}c@{}}変更パターン\\ 検出\end{tabular}} & \multicolumn{1}{c|}{\begin{tabular}[c]{@{}c@{}}変更パターン\\ 未検出\end{tabular}} \\ \hline
後方互換性無 &  &  \\ \hline
後方互換性有 &  &  \\ \hline
\end{tabular}
\label{table_pattern}
\end{table}

% ======================

表\ref{table_pattern}は，実際の後方互換性と，変更パターンの検出有無を示す．

結果ああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああ

考察うううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううううう

\section{おわりに}
本研究では，ライブラリテスト変更内容に基づく後方互換性の判定手法を提案し，判定精度を評価した．その結果，\todo{結果}．


%\begin{adjustvboxheight} % needed only when Appendix follows
\bibliographystyle{junsrt}
\bibliography{maekawa}
%\end{adjustvboxheight} % needed only when Appendix follows

% 以下はbibtexを使用しない場合の例です．
% 332行目と333行目をコメントアウトしてから使用してください．
% なお，この例では年数順に文献が並んでいるので適切な並び順ではありません．
%\begin{adjustvboxheight} % needed only when Appendix follows
%\begin{thebibliography}{9}
%\bibitem{fose2021} 名倉 正剛，関澤 俊弦 編：ソフトウェア工学の基礎28,日本ソフトウェア科学会{\em FOSE2021}, 近代科学社, 2021.
%\bibitem{fose2022} 角田 雅照，まつ本 真佑 編：ソフトウェア工学の基礎29,日本ソフトウェア科学会{\em FOSE2022}, 近代科学社, 2022.
%\bibitem{fose2023} 吉田 則裕，槇原 絵里奈 編：ソフトウェア工学の基礎30,日本ソフトウェア科学会{\em FOSE2023}, 近代科学社, 2023. （to appear）
%\end{thebibliography}
%\end{adjustvboxheight} % needed only when Appendix follows

%以下は付録の例です．必要ならコメントアウトして使用してください．
%なお，その際には参考文献の前後にある adjustvboxheight 環境のコメントアウトを解除してください．
%\appendix
%\section{付録A} 
%これは付録の例です．

\end{document}

