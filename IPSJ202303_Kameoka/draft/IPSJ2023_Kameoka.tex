\documentclass[uplatex,dvipdfmx,a4paper,twocolumn,base=11pt,jbase=11pt,ja=standard]{bxjsarticle}  % 環境に合わせて変更してください

\usepackage{ipsj}
\usepackage{color}

%追加パッケージ
\usepackage{enumerate}
\usepackage{url}
\usepackage[dvipdfmx]{graphicx}
%\usepackage{caption}

\newcommand{\todo}[1]{\colorbox{yellow}{{\bf TODO}:}{\color{red} {\textbf{[#1]}}}}

\title{発生頻度の少ないコーディング規約違反データ統合による\\検出精度向上への試み}{Toward improving detection accuracy by integrating occasional coding convention violations datasets}
\author{和歌山大学}{亀岡　令}{Ryo Kameoka, Wakayama University}
\author{和歌山大学}{伊原　彰紀}{Akinori Ihara, Wakayama University}
\author{和歌山大学}{南　雄太}{Yuta Minami, Wakayama University}
\author{和歌山大学}{大森　楓木}{Fuki Omori, Wakayama University}

\begin{document}
\maketitle

%================
%1
\section{はじめに}
%================
%hogehoge（背景，動機とか）
ソフトウェアを共同開発するプロジェクトでは，他者が実装したソースコードでも保守を容易にするために，コーディング規約を遵守する可読性の高いソースコードの実装が期待される．具体的には，PythonのPEP8やJavaのCode Conventions for the Java Programming Languageなど，各言語が標準的な規約を公開している．各プロジェクトは，保守性や可読性を高めるために記法やプログラムの複雑度などの特徴量の閾値を標準的な規約に加えて個々に定めることもある．

%開発者は保守管理の観点から，コーディング規約を遵守することによって可読性の高いコードを書くことが求められる．コーディング規約とは，ソースコードを記述する際に，保守性や可読性を高めるためにインデントや括弧などの記法を定めたものである．コーディング規約の例として，PythonのPEP8やJavaのCode Conventions for the Java Programming Languageなどがある．ただし，開発者が自らこれらの規約に違反しているコード断片を特定し，修正を行うことは時間的コストを要するため，静的解析ツールツールが用いられる．

多くのプロジェクトでは静的解析ツールを用いることで規約を違反するソースコードの検出を自動化している．一方で，開発者は検出されたすべての違反コードを修正するにはコストが大きすぎるため静的解析ツールが検出する膨大な違反の中から，修正すべき違反の選択が余儀なくされる．従来研究では，機械学習を用いて優先的に修正すべき規約違反を推薦する手法を提案している~\cite{article1}．しかし，規約違反の種類ごとの発生頻度が低く，修正率や発生率が低い規約は，推薦精度に影響する．特に，新規プロジェクトでは過去に発生した違反修正履歴を持たないため，規約違反の推薦は容易でない．


%静的解析ツールは，ツールによって定義されたルールによって該当するすべてのコーディング規約違反を検出することができる．これによってプログラム中のコーディング規約違反が大量に発見されることが多い．だが，開発者がここで発見された規約違反コードをすべて修正することは無い．従来研究では，機械学習を用いて静的解析ツールによって発見された規約違反が修正されたかを学習し，優先して修正すべき規約違反の検出を行っている~\cite{article1}．しかし，規約違反の種類ごとの分布には偏りがあるため，違反頻度の低い規約は機械学習において，予測精度は学習データセットの大きさ，正例不例の割合などに依存する問題が起こる．

%===============
本研究では，偏った規約違反の修正を予測するために連合学習を用いた，学習データと異なるプロジェクトの規約違反コード断片の修正が行われるかを予測するモデルを提案する．連合学習は，学習データから得られたモデルに加えて，別の学習データから得られたモデルも利用してモデルを構築するため，それぞれの学習データセットの特徴を考慮することができる．提案モデルを利用することによって，学習データの少ないプロジェクトに対しても修正予測を行うことができる．本研究では，プログラムの編集履歴を特徴量とし，違反が修正された編集の特徴をもとにし，連合学習によって構築されたモデルを利用することで，従来研究で規約違反が修正させるかを予測する．

%本研究では，連合学習を用いて学習することで，予測精度の向上させることを目的とする.連合学習は，学習データから得られたモデルに加えて，別の学習データから得られたモデルも利用してモデルを構築するため，それぞれの学習データセットの特徴を考慮することができる．具体的には，プログラムの編集履歴を特徴量とし，違反が修正された編集の特徴をもとにし，連合学習によって構築されたモデルを利用することで，規約違反が修正させるかを予測する．
%================
%2
\section{分析}
%================


%================
%hogehoge（どんなデータセット使ったか）

%fugofugo（そこからどんなデータをどうやって集めたか）

%2.1の修正版



%================
%2.2
\subsection{データセット}
本研究では，GitHubからPythonで実装されておりPylintを用いて開発しているtransitions, schematics, schema\_salad, python-bugzilla, python-cloudant, pyscard, pynput, OWSLib, howdoi, hickleの10リポジトリを対象とする．これらのリポジトリからそれぞれ1,000日間のコミット（中央値で501コミット分）を分析対象とする．

\subsection{分析手法}
規約違反が修正されるかの予測には，従来研究で使用されたものや本研究で加えた変更行数や複雑度などソースコードや編集についての44個の特徴量を抽出し，FedAvgアルゴリズムを用いた連合学習を行う~\cite{article2}．目的変数は，コミットにおいて規約違反が修正有無の2クラス分類とし，説明変数には規約違反の種類やソースコードの複雑度などの44個のパラメータを用いる．規約違反を修正したコミットが偏っていることがあり，予測データに正例が極端に含まれていない場合があるので学習データとテストデータは，コミットの古い順から7割を学習データとし，残り3割を予測データとすることで，時系列を考慮した予測を行う．

図~\ref{fig:explain}は，FedAvgを用いた連合学習の概要を示し，リポジトリごとの深層学習によって得られたモデルを集約し加重平均を取り，出力されたモデルをそれぞれの深層学習に配布する．配布されたモデルを用いて個々のノードは再度学習を行う．モデルの構築，得られたモデルの集約，再度学習を繰り返すことで，より精度の高いモデルを得る手法である．実装には，オープンソースフレームワークのOpenFLを用いる．

本論文で使用するFebAvgにおいて，深層学習のレイヤーは3層で，1，2層目はReLU層であり，3層目にシグモイド関数を用いた出力層となっている．最適化アルゴリズムにはAdamを利用し，学習率は0.01に設定した．

%===============
%FLの説明用図
%===============
%\begin{figure}[t]
%  \centering
%  \includegraphics[width=6.5cm]{federated_learning_exp.pdf} 
%  \caption{連合学習}
%  \label{fig:test}
%  \end{figure}

%\begin{figure}[t]
%	\centering
%	\includegraphics[width=1.0\linewidth]{federated_learning_exp.pdf}
%	\caption{連合学習の概略図}
%	\label{fig:test}
%\end{figure}

%-----------
\begin{figure}
\begin{center}
\includegraphics[width=0.9\linewidth]{federated_learning_exp.eps}
\caption{連合学習の概略図}
\label{fig:explain}
\end{center}
\end{figure}
%-----------

\begin{figure}
\begin{center}
\includegraphics[width=0.9\linewidth]{E0602federated_learning.eps}
\caption{連合学習による予測結果}
\label{fig:fed}
\end{center}
\end{figure}

\begin{figure}
\begin{center}
\includegraphics[width=0.9\linewidth]{E0602deep_learning.eps}
\caption{深層学習による予測結果}
\label{fig:deep}
\end{center}
\end{figure}


%================
%結果の表

% \begin{table}[t]
% \vspace{0mm}
 % \centering
 % \caption{分析結果}
% \label{tab:result3}
  % \scalebox{1.0}{
  % \begin{tabular}{l|r|r|r} \hline
    % & \multicolumn{1}{c|}{適合率} & \multicolumn{1}{c|}{再現率} & \multicolumn{1}{c}{F1値} \\ \hline
    % 連合学習モデル & 0.03 & 0.52 & 0.06 \\ \hline
    % 深層学習モデル & 0.03 & 0.32 & 0.05 \\ \hline
  % \end{tabular}
    % \label{tab:result1}
   % }
% \end{table}

%連合学習(over)
% 正解率：　0.613
% 適合率:  0.034
% 再現率:  0.523
% F1値:  0.063

%連合学習(under)
% 適合率:  0.03799660941991597
% 再現率:  0.28169398907103826
% F1値:  0.06696109631746444

%深層学習(over)
% 適合率:  0.02880505941352306
% 再現率:  0.3185792349726776
% F1値:  0.052833095448469605
%================
%2.4
\subsection{結果}
図~\ref{fig:fed}，図~\ref{fig:deep}はschematics，transitionsリポジトリに含まれる，Pylintで検出された規約違反のうち検出頻度に偏りがある規約１種類についての修正予測の評価結果である．閾値が低い場合に連合学習の再現率が高く，深層学習のモデルは閾値に関わらず全体的にすべての値が低いことがわかる．閾値が低い場合にも深層学習では再現率が低いことから，修正予測に必要な重みづけができていないことがわかる．

図~\ref{fig:fed}の結果おいて閾値が0.35の場合に最も適合率，再現率，F1値のバランスが取れていることがわかる．しかし，閾値が0.4以上の場合には，適合率に大きな変化がないが，再現率が下がっている．したがって，連合学習によって規約違反修正の予測に効果がある兆候が確認できるが，モデルとして不十分である．

%================
%hogehoge（どんな結果が得られたか，図とかを一緒に載せる）

%fugofugo（結果からの考察）
%分析を行った結果次のような結果が得られた．

%--------------------------------表入れるとこ



%================
%3
\section{おわりに}

本研究では，静的解析ツールによって検出された規約違反が予測地点において修正されるかを，　連合学習によって精度向上を試みた．今後の方針として，データセットの拡張，違反頻度の低い規約違反への重み付けなどを用いて予測精度の高いモデルの構築を目指す．
%================

%hogehoge（今回の研究のまとめとか）

%fugofugo（今回研究から得られたことを踏まえて今後どう発展させていくか）

%４２（どんな研究をしていくつもりなのか的な）
%今回の研究のから　hogehoge-fugofugoである．

%\begin{figure}[h]
%  \centering
%  \includepraphics[width=6.5cm]{example.png}
%  \caption{図のキャプション}
%\end{figure}


%================
\section*{謝辞}
〜〜〜
%================


\begin{thebibliography}{1}
    \bibitem{article1} Joseph R. Ruthruff, John Penix, J. David Morgenthaler, Sebastian Elbaum, and Gregg Rothermel: Predicting Accurate and Actionable Static Analysis Warnings: An Experimental Approach: Proceedings of the 30th international conference on Software engineering(ICSE), pp. 341-350, (2008)
    \bibitem{article2} Brendan McMahan, Eider Moore, Daniel Ramage, Seth Hampson, Blaise Aguera y Arcas: Communication-Efficient Learning of Deep Networks from Decentralized Data: Proceedings of the 20th International Conference on Artificial Intelligence and Statistics (PMLR), No54, pp. 1273-1282, (2017)
\end{thebibliography}




\bibliographystyle{ipsjunsrt}
%\bibliography{bibfile}

\end{document}
