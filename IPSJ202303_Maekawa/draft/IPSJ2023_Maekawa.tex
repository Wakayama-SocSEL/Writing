\documentclass[uplatex,dvipdfmx,a4paper,twocolumn,base=11pt,jbase=11pt,ja=standard]{bxjsarticle}  % 環境に合わせて変更してください

\usepackage{ipsj}
\usepackage{color}

%追加パッケージ
\usepackage{enumerate}
\usepackage{url}
\usepackage{graphics}
\usepackage{caption}

\newcommand{\todo}[1]{\colorbox{yellow}{{\bf TODO}:}{\color{red} {\textbf{[#1]}}}}

\title{後方互換性の損失に伴うテストコード変更内容の分類}{A classification of test code changes accompanied by a lack of backward compatibility}
\author{和歌山大学}{前川　大樹}{Daiki Maekawa, Wakayama University}
\author{和歌山大学}{伊原　彰紀}{Akinori Ihara, Wakayama University}
\author{和歌山大学}{大森　楓己}{Fuki Omori, Wakayama University}
\author{和歌山大学}{才木　一也}{Kazuya Saiki, Wakayama University}

\begin{document}
\maketitle

%================
%1
\section{はじめに}
%================
% （概要）ソフトウェアライブラリの更新において，開発者は意図せずに後方互換性を損失する変更（破壊的変更）を追加してしまうことがある．従来研究では，ライブラリに破壊的変更を加えたリリースバージョンではテストコードも修正すると考え，テストコードの変更有無による破壊的変更の検出手法を提案した．しかし，テストコードの変更はライブラリ変更に関係するとは限らないため，破壊的変更を誤検出することがある．本研究では，破壊的変更に伴うテストコード変更内容の分類に取り組み，テスト変更内容に基づく破壊的変更の検出精度を向上する．

ソフトウェア開発では，開発効率向上のためにライブラリと呼ばれるプログラムを再利用することがある．ライブラリは新機能やバグ修正のために頻繁に更新されるため，ライブラリ利用者は適宜アップデートをする必要がある．しかし，ライブラリの更新には後方互換性を損失する変更（破壊的変更）が含まれることがあり，利用者のプログラムの実行エラーにつながることがある．そのため，ライブラリ開発者はライブラリを更新する際，破壊的変更の有無を判断し，適切なバージョン名を付与することで，破壊的変更の有無をライブラリ利用者に伝達する．しかし，破壊的変更の有無の確認は手動であるため，ライブラリ開発者が破壊的変更を見逃してしまい，意図せず利用者のプログラムが破壊されてしまうことがある．

従来研究~\cite{FOSE2021_Matsuda}では，ライブラリに破壊的変更を加えたリリースバージョンではテストコードも修正すると考え，テストコードの変更有無による破壊的変更の検出手法を提案した．しかし，テストコードの変更には，テストの誤り修正や実行手順の修正など，ライブラリ変更とは無関係のものも存在するため，破壊的変更を誤検出することがある．本研究では，従来手法による誤検出を減らすために，テストコード変更内容の分類に取り組み，テスト変更に基づく破壊的変更の検出精度向上を目指す．

%================
%2
\section{分析}
%================
%2.1
\subsection{データセット}
%================

本研究では，松田らのデータセット~\cite{FOSE2021_Matsuda}を使用する．データセットには，npmから収集した，人気度が高くテストが整備されているライブラリバージョン2,111組が含まれている．このデータセットから，npmに公開され，ライブラリテストに変更があり，テスト変更のdiffサイズが1024*2バイト以下であるもの1,027組を使用する．対象データ1,027組から実際に破壊的変更が含まれるバージョンと含まれないバージョンを50組ずつランダムに抽出し計100組を分析した．

本研究では，従来研究と同様に，ライブラリ利用者のプログラムがライブラリの新しいバージョンを利用することで，テストが失敗した場合に，ライブラリの新しいバージョンに破壊的変更が加えられたと判断する．

%================
%2.2
\subsection{分析手法}
%================

100件のデータについて，2段階に分けて分析する．
\vspace{-2mm}
\begin{enumerate}
 \item テスト変更パターンを分類し出現回数を集計する
 \item 1．をもとに，決定木を用いて，破壊的変更に関係するテスト変更パターンについて分析する
\end{enumerate}

１．について，テストプログラムは，複数のテストケースからなるテストスイートが組み合わさって構成されており，個々のテストケースには，前提となる条件，期待する結果などが記述されている．これらをもとに，ライブラリテストの変更内容を，テストケースの追加，削除，期待する結果の変更など，計18種類に分類した．分類をもとに，100件のライブラリバージョンについて，それぞれの出現回数を集計した．

２．について，破壊的変更の有無に影響を与えるテスト変更パターンを探索するために，実際の破壊的変更の有無を目的変数とし，テスト変更内容１８種類を説明変数とする決定木分析を行った.

%================
%2.4
\subsection{結果}
%================

表\ref{table_test_patern}は，テスト変更パターンと，それぞれの合計件数，実際の破壊的変更の有無を示す．本論文では，18種類のテスト変更パターンから，決定木分析によって特に破壊的変更有無に影響が高いとわかった３件を示す．

\noindent\textbf{等価な変数や関数に置換: }

\todo{なぜ影響が高いのか，自動分類が可能かどうか考察？}
%等価な変数や関数に置換する変更が多ければ，破壊的変更である可能性が高い
%件数が少ないから？

\noindent\textbf{テストケースの追加: }

\todo{なぜ影響が高いのか，自動分類が可能かどうか考察？}
%テストケースが追加されているということは，あるテスト対象の関数の挙動が変わったため，テストケースを追加する必要があったといえるので，破壊的変更に関係していそう
%テストケースはit()で囲むなどの慣習があるので，自動分類はできそう
%ライブラリを使用していない場合に対応できればいけそう

\noindent\textbf{期待する結果の変更: }

\todo{なぜ影響が高いのか，自動分類が可能かどうか考察？}
%期待する結果の変更，すなわち，equals, should, assert文の引数の変更
%テスト対象の関数のある処理について，期待する結果が変わることは，関数のある処理の挙動が変わったといえるので，破壊的変更に関係していそう
%astを用いて自動分類できそう？


%今のところ，破壊的変更と関係のありそうなテスト変更が上位に来ている．
%従来研究の課題である，破壊的変更とは無関係のテスト変更（テストのリファクタリングなど）を検出してしまうのを防ぎたい，というモチベーションの場合，破壊的変更とは関係ないと言えるものを探す方がいい？
%テストのリファクタリングは他の変更と同時に行われるのが普通なので，破壊的変更であるバージョン間にも，そうでないバージョン間にも出現する．→決定木分析では上位にこない．

%================
\begin{table*}[t]
  \caption{ライブラリテスト変更パターンの分類}
  \label{table_test_patern}
  \centering
  \scalebox{1}{
  \begin{tabular}{|l|r|r|r|}
        \hline
        テスト変更パターン & \multicolumn{1}{c|}{破壊的変更あり} & \multicolumn{1}{c|}{破壊的変更不明} & \multicolumn{1}{c|}{合計件数} \\ \hline
        等価な変数や関数に置換 & 11件 & 1件 & 12件 \\ \hline
        テストケースの追加 & 85件 & 57件 & 28件 \\ \hline
        期待する結果の変更 & 27件 & 6件 & 33件 \\ \hline
  \end{tabular}
  }

\end{table*}
%================

%================

%================
%3
\section{おわりに}
%================

本研究は，テスト変更の内容分類に取り組み，テスト変更パターンと破壊的変更有無の関係性を決定木により分析した．分析の結果，ライブラリテストの変更パターンとして，テストケースの追加，期待する結果の変更が含まれると，破壊的変更が含まれる可能性が高いとわかった．今後は，テスト変更パターンの自動分類に取り組み，テスト変更内容に基づく破壊的変更の検出手法の精度向上を目指す．

%================
\section*{謝辞}
%================

\todo{謝辞}

%================
%\section*{参考文献}
%================
\bibliographystyle{ipsjunsrt} 
\bibliography{bibfile}

\end{document}
